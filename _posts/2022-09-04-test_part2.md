---
title: "[Test] part.2 Jest"
date: 2022-09-04 21:00:00 +/0900
categories: [Test]
tags: [Test, Jest]
---

<p>
    í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ 3ë‹¨ê³„ì˜ ê°€ì¥ ë°‘ë°”íƒ•ì´ë˜ëŠ” unit testë¥¼ ë¨¼ì € ì‹œì‘í•œë‹¤.
</p>

## Jest

- ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
- create-react-appìœ¼ë¡œ react í”„ë¡œì íŠ¸ë¥¼ ìƒì„±ì‹œ í•¨ê»˜ ì„¤ì¹˜ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ê¸° ë•Œë¬¸ì— React í™˜ê²½ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ì•ì„œì„œ vailla javascriptë¥¼ Jestë¡œ í…ŒìŠ¤íŠ¸í•œë‹¤.

### Jest í™˜ê²½ì„¤ì •

1. JestëŠ” javascript í™˜ê²½ì—ì„œ ì‚¬ìš©í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— node jsì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ npm í™˜ê²½ì„ ì„¤ì •í•œë‹¤.

   ```
   npm init --yes
   ```

   npm í™˜ê²½ì„¤ì •ì´ ì™„ë£Œë˜ë©´ package.jsoníŒŒì¼ì´ ìƒì„±ë˜ê³ 

2. Jest ë¥¼ ì„¤ì¹˜í•œë‹¤.

   ```
   npm install jest --global
   ```

3. jest ì‹œì‘ + jest.config.js íŒŒì¼ ì„¤ì¹˜

   ```
   jest --init
   ```

   [jest.config.js ê´€ë ¨ ì •ë³´](https://jestjs.io/docs/configuration)

4. jest í•¨ìˆ˜ì˜ ì‚¬ìš©ë²•ì„ ì‰½ê²Œ íŒŒì•…í•˜ê¸° ìœ„í•´ jest íƒ€ì…ì„ ì„¤ì¹˜í•œë‹¤. jestíƒ€ì…ì„ ì„¤ì¹˜í•˜ë©´ package.jsonì— @types/jest dependencyê°€ ì„¤ì¹˜ë˜ê³  jestê´€ë ¨ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê³  ctrl + click(cursor)ë¥¼ ëˆ„ë¥´ë©´ ì‚¬ìš©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

   ```
   npm install @types/jest
   ```

5. package.jsonì— jest script ì¶”ê°€

   ```
   "scripts": {
       "test": "jest",
       "clear_jest": "jest --clearCache"
   },
   ```

   <code>npm run test</code> ë¡œ jestë¥¼ ì‹¤í–‰, <code>npm run clear_jest</code>ë¡œ ê¸°ì¡´ì˜ jest ìˆ˜í–‰ê²°ê³¼ cacheë¥¼ ì‚­ì œí•œë‹¤.

### í•¨ìˆ˜ í…ŒìŠ¤íŠ¸

í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ mockì„ ì‚¬ìš©í•œë‹¤.
mockì€ í•¨ìˆ˜ë¥¼ íƒœìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ê°€ì§œ(mock)ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ëŒ€ì²´í•˜ëŠ” ê¸°ë²•ì„ ë§í•œë‹¤.
ì¼ë°˜ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ë ¤ëŠ” ì½”ë“œê°€ ì˜ì¡´í•˜ëŠ” ë¶€ë¶„ì„ ì§ì ‘ ìƒì„±í•˜ê¸°ê°€ ë¶€ë‹´ìŠ¤ëŸ¬ìš´ ê²½ìš° mockingì´ ì‚¬ìš©ëœë‹¤.

#### check.js

```javascript
function check(predicate, onSuccess, onFail) {
  if (validate()) {
    onSuccess("yes");
  } else {
    onFail("no");
  }
}

module.exports = check;
```

<p>
 í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ export ì„¤ì •ì„ í•œë‹¤.
</p>

#### check.test.js

check.js í…ŒìŠ¤íŠ¸í•˜ê¸°ìœ„í•´ ë¨¼ì € check.jsë¥¼ importí•œë‹¤.

```javascript
const check = require("../check");
```

í•œ í•¨ìˆ˜ì—ì„œ ë‹¤ì–‘í•œ ìƒí™©ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ describeë¡œ ë¬¶ëŠ”ë‹¤. ëª¨ë“  í…ŒìŠ¤íŠ¸ëŠ” 'check'ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë¬¶ì¸ë‹¤.

```javascript
describe("check", () => {
    ...
});
```

describeë‚´ë¶€ì—ì„œ ê° í…ŒìŠ¤íŠ¸ë³„ë¡œ í…ŒìŠ¤íŠ¸ ì‹œì‘ì „ì— ê³µí†µì ìœ¼ë¡œ ë¶ˆë¦¬ëŠ” ì½”ë“œëŠ” beforeEach()ë¡œ ë¬¶ì–´ì„œ ì¬ì‚¬ìš©ì„±ì„ ë†’ì¸ë‹¤.<br/>
it í˜¹ì€ testë¡œ í…ŒìŠ¤íŠ¸í•  ìƒí™©ì„ ì •ì˜í•˜ê³  ì²«ë²ˆì§¸ ì¸ìë¡œ ìƒí™©ì„ ì •ì˜í•˜ëŠ” ë¬¸ì¥ì„ , ë‘ë²ˆì§¸ ì¸ìëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œ í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.

```javascript
describe("check", () => {
  let onSuccess;
  let onFail;

  beforeEach(() => {
    onSuccess = jest.fn();
    onFail = jest.fn();
  });


  it("should call onSuccess when validate is true", () => {
    ...
  });

  it("should call onFail when validate is false", () => {
    ...
  });
});
```

<p>
    ê° í…ŒìŠ¤íŠ¸ ë³„ë¡œ í•¨ìˆ˜ë¥¼ ë¶€ë¥´ê³  expectë¥¼ í†µí•´ ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ë¥¼ ì‘ì„±í•œë‹¤.<br/>
    í…ŒìŠ¤íŠ¸ ë³„ë¡œ ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ëŠ” expect í•¨ìˆ˜ì˜ matcher<https://jestjs.io/docs/using-matchers>ë¡œ ì˜ˆìƒí•œ ê²°ê³¼ë¥¼ ì…ë ¥í•œë‹¤.
</p>

```javascript
//it í˜¹ì€ testë¡œ í…ŒìŠ¤íŠ¸í•  ìƒí™©ì„ ì •ì˜í•˜ê³  ì²«ë²ˆì§¸ ì¸ìë¡œ ìƒí™©ì„ ì •ì˜í•˜ëŠ” ë¬¸ì¥ì„ , ë‘ë²ˆì§¸ ì¸ìëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œ í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.
it("should call onSuccess when validate is true", () => {
  check(() => true, onSuccess, onFail);

  //expect(onSuccess.mock.calls.length).toBe(1);
  expect(onSuccess).toHaveBeenCalledTimes(1);

  //expect(onSuccess.mock.calls[0][0]).toBe('yes');
  expect(onSuccess).toHaveBeenCalledWith("yes");

  //expect(onFail.mock.calls.length).toBe(0);
  expect(onFail).toHaveBeenCalledTimes(0);
});

it("should call onFail when validate is false", () => {
  check(() => false, onSuccess, onFail);

  //expect(onFail.mock.calls.length).toBe(1);
  expect(onFail).toHaveBeenCalledTimes(1);

  //expect(onFail.mock.calls[0][0]).toBe('no');
  expect(onFail).toHaveBeenCalledWith("no");

  //expect(onSuccess.mock.calls.length).toBe(0);
  expect(onSuccess).toHaveBeenCalledTimes(0);
});
```

### failí•˜ë„ë¡ ìˆ˜ì •í•œ ì½”ë“œ

![check.test.jsì˜ validate ì½”ë“œê°€ failì´ ë˜ë„ë¡ ìˆ˜ì •í•œ ì½”ë“œ](/assets/img/check_test_validate_false.png)

### fail ê²°ê³¼ ìº¡ì³í™”ë©´

![check.test.jsì˜ fail ê²°ê³¼ í™”ë©´](/assets/img/check_test_fail.png)

<p>
    í…ŒìŠ¤íŠ¸ì—ì„œ ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šìœ¼ë©´ failê³¼ í•¨ê»˜ should call onSuccess when predicate is trueí…ŒìŠ¤íŠ¸ì—ì„œ í‹€ë ¸ë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>
    í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì˜ë„ëœ ëŒ€ë¡œ ì‘ì„±ë˜ì—ˆì§€ë§Œ êµ¬í˜„ ì½”ë“œê°€ ì˜ëª»ë˜ì–´ ì‹¤íŒ¨í–ˆë‹¤ë©´ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•  ë•Œê¹Œì§€ êµ¬í˜„ ì½”ë“œë¥¼ ìˆ˜ì •í•œë‹¤.
</p>

ğŸ’¡ì°¸ê³ 

- [[Jest] jest.fn(), jest.spyOn() í•¨ìˆ˜ ëª¨í‚¹](https://www.daleseo.com/jest-fn-spy-on/)
